{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "principalId": {
            "type": "array"
        },
        "appId": {
            "type": "string"
        },
        "principalSecret": {
            "type": "securestring"
        },
        "adoPAT": {
            "type": "securestring"
        },
        "adoOrgName": {
            "type": "string"
        },
        "adoProjectName": {
            "type": "string"
        },
        "ghOrgName": {
            "type": "string"
        },
        "ghRepoName": {
            "type": "string"
        },
        "ghPAToken": {
            "type": "securestring"
        },
        "prefix": {
            "type": "string"
        },
        "subscriptionId": {
            "type": "string"
        },
        "environment": {
            "type": "string"
        }
    },
    "variables": {
        "userManagedIdentityName": "[concat('test', '-umi')]",
        "azDevOpsVariables": "\"b2cResultWorkerClientSecret\" = \"myb2cResultWorkerClientSecretValue\" \"loadtestUserPassword\" = \"myLoadtestUserPassword\" \"smokePassword\" = \"mySmokePassword\""
    },
    "resources": [
        {
            "type": "Microsoft.Resources/deploymentScripts",
            "apiVersion": "2020-10-01",
            "name": "[concat('ao-pipeline-rg', '-ado')]",
            "location": "northeurope",
            "kind": "AzurePowerShell",
            "dependsOn": [],
            "properties": {
                "primaryScriptUri": "https://raw.githubusercontent.com/hjscherer/AO/dev/aoArm/deploymentScript/AzDevOps-Deploy.ps1",
                "arguments": "[concat('-AzureTenantId', ' ', '72f988bf-86f1-41af-91ab-2d7cd011db47', ' ',
                                      '-AzureSubscriptionId', ' ', subscription().subscriptionId, ' ',
                                      '-AzDevOpsOrgUrl', ' ', parameters('adoOrgName'), ' ',
                                      '-AzDevOpsProjectName', ' ', parameters('adoProjectName'), ' ',
                                      '-AzDevOpsEnvironmentName' , ' ', parameters('environment'), ' ',
                                      '-ServicePrincipalName', ' ', 'todelete-ao', ' ',
                                      '-GithubPAT', ' ', 'test', ' ',
                                      '-GithubAccountName', ' ', parameters('ghOrgName'), ' ',
                                      '-GithubRepoName', ' ', parameters('ghRepoName'), ' ',
                                      '-GithubBranchName', ' ', 'new-test', ' ',
                                      '-SkipFirstPipelineRun', ' ', '$True' , ' ',
                                      '-AzDevOpsVariables', ' ', variables('azDevOpsVariables'), ' ',
                                      '-SmokeTestUserName', ' ', '\"user@demo.always-on.app\"')]",
                                      
                "environmentVariables": [
                    {
                        "name": "AZURE_DEVOPS_EXT_PAT",
                        "value": "[parameters('adoPAT')]"
                    }
                ],
                "azPowerShellVersion": "6.3",
                "supportingScriptUris": [
                    "https://raw.githubusercontent.com/hjscherer/AO/dev/aoArm/deploymentScript/AzDevOps-Functions.ps1"
                ],
                "timeout": "PT30M",
                "cleanupPreference": "Always",
                "retentionInterval": "P1D"
            }
        }
    ],
    "outputs": {}
}